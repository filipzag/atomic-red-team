name: Add NOPASSWD Entry to Sudoers via tee
description: |
  Simulates an attacker adding a NOPASSWD entry to /etc/sudoers.d/ using tee,
  allowing a user to run all commands as root without a password. This is a
  high-confidence privilege escalation and persistence technique that directly
  triggers the 'Linux Sudoers NOPASSWD Entry Modification' detection rule.
  Maps to MITRE ATT&CK T1548.003 (Sudo and Sudo Caching).
supported_platforms:
  - linux
input_arguments:
  username:
    description: The username to grant NOPASSWD sudo access
    type: string
    default: testuser
  sudoers_file:
    description: Path to the sudoers drop-in file to create
    type: path
    default: /etc/sudoers.d/atomic_test_nopasswd
executor:
  name: bash
  elevation_required: true
  command: |
    printf '%s ALL=(ALL) NOPASSWD: ALL\n' "#{username}" | tee #{sudoers_file}
    chmod 0440 #{sudoers_file}
    visudo -c -f #{sudoers_file}
  cleanup_command: |
    rm -f #{sudoers_file}
