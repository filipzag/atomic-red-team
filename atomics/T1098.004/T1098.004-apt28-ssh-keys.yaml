name: APT28 SSH Authorized Keys Persistence Simulation
description: >
  Simulates APT28-style persistence by creating or modifying the SSH authorized_keys file.
  This test creates the .ssh directory if needed, writes a test SSH public key to authorized_keys,
  and verifies the modification generates file events for detection validation.
  Reference: https://attack.mitre.org/techniques/T1098/004/
supported_platforms:
  - linux
input_arguments:
  target_user_home:
    description: Home directory of the target user
    type: path
    default: /tmp/art-test-user
  ssh_public_key:
    description: SSH public key to inject (benign test key)
    type: string
    default: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7test+key+for+atomic+red+team+validation+only art-test@simulation"
executor:
  name: bash
  elevation_required: false
  command: |
    mkdir -p #{target_user_home}/.ssh
    chmod 700 #{target_user_home}/.ssh
    touch #{target_user_home}/.ssh/authorized_keys
    chmod 600 #{target_user_home}/.ssh/authorized_keys
    cat >> #{target_user_home}/.ssh/authorized_keys <<EOF
    #{ssh_public_key}
    EOF
  cleanup_command: |
    rm -rf #{target_user_home}/.ssh
    rmdir #{target_user_home} 2>/dev/null
